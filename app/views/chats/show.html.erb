<h1 class="form-title">Find Your Next Movie 🎬</h1>
<div class="container my-5" style="max-width: 900px; margin: 0 auto;">
  <header class="show-header mb-4">
    <%= link_to "⬅️ Back to Movie Search", chats_path %>
  </header>

  <div class="container my-2">
  <h3 class="mb-1">Chat: <i>"<%= @chat.mood %>"</i></h1>
    <div class="row">
      <% @movies.each do |movie| %>
        <div class="col-md-4 mb-4">
          <div class="card" style="max-width: 18rem;">
            <%= image_tag "dark-night.jpg", class: "card-img-top", alt: "image of the movie", style: "height: 250px; object-fit: contain;" %>
            <div class="card-body">
              <h5 class="card-title"><%= movie.title %></h5>
              <p class="card-text"><%= movie.description %></p>
              <%= link_to "See movie details", movie_path(movie), class: "btn btn-primary" %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
  <!-- Chat moderne avec historique -->
  <div class="card mt-4 p-3" style="background: white; max-width: 900px; margin: auto; box-shadow: 0 2px 8px rgba(108, 107, 107, 0.1); border-radius:8px">
    <h5 class="card-title fw-bold mb-4" style="font-size: 1.25rem;">Keep discussing with your movie assistant to get better suggestions 🍿</h5>

    <!-- Historique des messages -->
    <div class="mb-4" style="max-height: 500px; overflow-y: auto; background: white">
    <% @messages.each do |message| %>
        <% if message.role == "assistant" %>
          <div class="d-flex mb-3">
            <div class="bg-light" style="max-width: 80%; white-space: pre-wrap; line-height: 1.3; padding: 1px 12px; border-radius: 8px; font-size: 1rem">
              <%= message.content.strip %>
            </div>
          </div>
        <% else %>
          <div class="d-flex justify-content-end mb-3">
            <div class="bg-primary text-white" style="max-width: 80%; white-space: pre-wrap; line-height: 1.3; padding: 1px 12px; border-radius: 8px; font-size: 1rem;">
              <%= message.content.strip %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>

    <!-- Champ de saisie et bouton -->
    <%= form_with model: [@chat, Message.new], url: chat_messages_path(@chat), class: "d-flex" do |f| %>
      <%= f.text_field :content, class: "form-control", style: "border-radius: 6px 0 0 6px; border-right: none; background: white;", placeholder: "Type your message..." %>
      <%= f.submit "Send", class: "btn btn-primary", style: "border-radius: 0 6px 6px 0;" %>
    <% end %>
  </div>
</div>
