<h1>Your results for <i>"<%= @chat.title %>"</i></h1>

<div class="container my-5">
  <div class="row">
    <% @movies.each do |movie| %>
      <div class="col-md-4 mb-4">
        <div class="card" style="max-width: 18rem;">
          <%= image_tag "dark-night.jpg", class: "card-img-top", alt: "image of the movie", style: "height: 250px; object-fit: contain;" %>
          <div class="card-body">
            <h5 class="card-title"><%= movie.title %></h5>
            <p class="card-text"><%= movie.description %></p>
            <%= link_to "See movie details", movie_path(movie), class: "btn btn-primary" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
<!-- Chat moderne avec historique -->
<div class="card mt-4 p-3" style="max-width: 900px; margin: auto;">
  <h5 class="card-title">Cinematch chat</h5>

  <!-- Historique des messages -->
  <div class="mb-3" style="max-height: 500px; overflow-y: auto;">
   <% @messages.each do |message| %>
      <% if message.role == "assistant" %>
        <div class="d-flex mb-2">
          <div class="bg-light rounded padding: 8px 12px" style="max-width: 80%; white-space: pre-wrap; line-height: 1.4; padding: 6px 16px">
            <%= message.content %>
          </div>
        </div>
      <% else %>
        <div class="d-flex justify-content-end mb-2">
          <div class="bg-primary text-white rounded padding: 8px 12px" style="max-width: 80%; white-space: pre-wrap; line-height: 1.4; padding: 6px 16px">
            <%= message.content %>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>

  <!-- Champ de saisie et bouton -->
  <%= form_with model: [@chat, Message.new], url: chat_messages_path(@chat), class: "input-group" do |f| %>
    <%= f.text_field :content, class: "form-control", placeholder: "Type your message..." %>
    <%= f.submit "Send", class: "btn btn-primary" %>
  <% end %>
</div>
